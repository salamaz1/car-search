<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>

<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>

<body>

<!-- Ø§Ù„Ø´Ø¹Ø§Ø± -->
<div class="logo-container">
  <img src="assets/logo.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ØµØ¯Ø§Ø±Ø©">
</div>

<h2>ğŸ” Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h2>

<!-- Ø§Ù„Ø¨Ø­Ø« -->
<div class="search-wrapper">
  <input id="search" placeholder="Ø¨Ø­Ø« (Ù†ÙˆØ¹ØŒ Ù…ÙˆØ¯ÙŠÙ„ØŒ Ø±Ù‚Ù… Ù‡ÙŠÙƒÙ„...)">
  <button id="clear-search">âœ–</button>
</div>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© -->
<div class="brand-filters status-filters">
  <button class="active" data-status="all">Ø§Ù„ÙƒÙ„</button>
  <button data-status="sold">ØªÙ… Ø§Ù„Ø¨ÙŠØ¹</button>
</div>

<!-- Ø£Ø²Ø±Ø§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
<div id="type-filters" class="brand-filters"></div>

<div class="counter" id="counter"></div>

<div id="cards" class="cards">
  <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
</div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vR2sKJaXG_woDQOQge29zkhGyyWil3njTr8dmL9CqXdqV-e3Bi9JfTfqcLpdGMVPA/pub?output=csv";

let allData = [];
let currentType = "Ø§Ù„ÙƒÙ„";
let statusFilter = "all";

const cardsDiv = document.getElementById("cards");
const searchInput = document.getElementById("search");
const clearBtn = document.getElementById("clear-search");
const typeFiltersDiv = document.getElementById("type-filters");
const counterDiv = document.getElementById("counter");

/* ========= Ø£Ø¯ÙˆØ§Øª Ø±Ù‚Ù…ÙŠØ© ========= */
function cleanNumber(v){
  if(!v) return null;
  return parseInt(v.toString().split(/[.,Ù«]/)[0].replace(/[^\d]/g,""),10);
}

function formatLYD(v){
  const n = cleanNumber(v);
  if(!n || n<=0) return "-";
  return n.toLocaleString("en-US")+" Ø¯.Ù„";
}
function formatKRW(v){
  const n = cleanNumber(v);
  if(!n || n<=0) return "-";
  return "â‚© "+n.toLocaleString("en-US");
}
function formatUSD(v){
  const n = cleanNumber(v);
  if(!n || n<=0) return "-";
  return "$ "+n.toLocaleString("en-US");
}

/* ========= Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ ========= */
function calculateProfit(sell,cost){
  const s = cleanNumber(sell);
  const c = cleanNumber(cost);
  if(!s || !c) return {text:"-",cls:""};
  const d = s - c;
  const t = Math.abs(d).toLocaleString("en-US")+" Ø¯.Ù„";
  if(d>0) return {text:t,cls:"profit-positive"};
  if(d<0) return {text:"-"+t,cls:"profit-negative"};
  return {text:"0 Ø¯.Ù„",cls:""};
}

/* ========= Ù‚Ø±Ø§Ø¡Ø© CSV ========= */
Papa.parse(CSV_URL,{
  download:true,
  header:true,
  skipEmptyLines:true,
  complete:(res)=>{
    allData = res.data;
    buildTypeFilters();
    applyFilters();
  }
});

/* ========= Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ ========= */
function buildTypeFilters(){
  const types = [...new Set(allData.map(c=>c["Ø§Ù„Ù†ÙˆØ¹"]).filter(Boolean))];

  typeFiltersDiv.innerHTML =
    `<button class="active" data-type="Ø§Ù„ÙƒÙ„">Ø§Ù„ÙƒÙ„</button>`+
    types.map(t=>`<button data-type="${t}">${t}</button>`).join("");

  typeFiltersDiv.querySelectorAll("button").forEach(btn=>{
    btn.onclick=()=>{
      typeFiltersDiv.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      currentType = btn.dataset.type;
      applyFilters();
    };
  });
}

/* ========= Ø§Ù„ÙÙ„ØªØ±Ø© ========= */
function applyFilters(){
  const text = searchInput.value.toLowerCase();

  const filtered = allData.filter(car=>{
    const matchSearch =
      Object.values(car).join(" ").toLowerCase().includes(text);

    const matchType =
      currentType==="Ø§Ù„ÙƒÙ„" || car["Ø§Ù„Ù†ÙˆØ¹"]===currentType;

    const matchStatus =
      statusFilter==="all" ||
      (car["Ø§Ù„Ø­Ø¶ÙŠØ±Ø©"]||"").includes("Ø¨ÙŠØ¹");

    return matchSearch && matchType && matchStatus;
  });

  counterDiv.textContent =
    `Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶: ${filtered.length} | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${allData.length}`;

  render(filtered);
}

/* ========= Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ========= */
function render(data){
  cardsDiv.innerHTML="";
  if(!data.length){
    cardsDiv.innerHTML="<div class='loading'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>";
    return;
  }

  data.forEach(car=>{
    const profit = calculateProfit(car["Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹"],car["Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©"]);

    const card=document.createElement("div");
    card.className="card";

    card.innerHTML=`
      <div class="card-header">
        <h3>${car["Ø§Ù„Ù†ÙˆØ¹"]||""} - ${car["Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„"]||""}</h3>
        <div>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙŠÙƒÙ„: ${car["Ø±Ù‚Ù… Ø§Ù„Ù‡ÙŠÙƒÙ„"]||"-"}</div>
        <div>Ø§Ù„Ø­Ø§Ù„Ø©: ${car["Ø§Ù„Ø­Ø¶ÙŠØ±Ø©"]||"-"}</div>
      </div>

      <div class="card-cost">
        Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${formatLYD(car["Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©"])}
      </div>

      <div class="details">
        ${Object.keys(car).map(k=>{
          let v=car[k],cls="";
          if(k==="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ - ÙˆÙˆÙ†") v=formatKRW(v);
          else if(k==="ØªÙƒÙ„ÙØ© Ø§Ù„Ø´Ø­Ù† - Ø¯ÙˆÙ„Ø§Ø±") v=formatUSD(v);
          else if(k==="Ø§Ù„Ø±Ø¨Ø­"){v=profit.text;cls=profit.cls;}
          else if(k.includes("Ø³Ø¹Ø±")||k.includes("ØªÙƒÙ„ÙØ©")||k.includes("Ù…ØµØ§Ø±ÙŠÙ")||k.includes("Ø¹Ù…ÙˆÙ„Ø©"))
            v=formatLYD(v);

          return `<div class="detail-row ${cls}">
            <span>${k}</span><span>${v||"-"}</span></div>`;
        }).join("")}
      </div>
    `;
    card.onclick=()=>card.classList.toggle("open");
    cardsDiv.appendChild(card);
  });
}

/* ========= Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ========= */
searchInput.onkeyup=()=>{
  clearBtn.style.display=searchInput.value?"block":"none";
  applyFilters();
};
clearBtn.onclick=()=>{
  searchInput.value="";
  clearBtn.style.display="none";
  applyFilters();
};

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø§Ù„Ø© */
document.querySelectorAll('.status-filters button').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.status-filters button')
      .forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    statusFilter = btn.dataset.status;
    applyFilters();
  };
});
</script>

</body>
</html>
